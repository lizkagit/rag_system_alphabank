Настройка RAG
для вопросов и ответов
Создайте интеллектуальный pipeline RAG-системы, которая по пользовательскому
запросу находит наиболее релевантные фрагменты в корпусе данных.

2

Постановка задачи

2

Разработайте pipeline
RAG-системы, которая по
входному вопросу находит
релевантные фрагменты
в предоставленном корпусе
данных. Для этого:

Изучите метод генерации
с дополнительной выборкой
(RAG).

Постройте retrieval-пайплайн,
который возвращает топ-5
документов для каждого вопроса.

Отправьте решение на платформу
в формате файла .csv и узнайте
его качество в виде оценки
с помощью метрики Hit@5.

Доработайте ваше решение
и повторно отправьте его на сайт
для повышения результата.
Изучите структуру
представленного корпуса
текстовых данных с вопросами
пользователей и распарсенных
с сайта alfabank.ru подстраниц.

3

Бизнес-контекст

Вопросно-ответные (Q&A) системы — это прикладные ИИ-сервисы, которые

принимают текстовый вопрос и возвращают точный, краткий ответ. В классиче-
ском варианте есть два подхода: экстрактивный (фраза-ответ берется из источ-
ника) и абстрактивный (ответ генерируется моделью по доступной в ее базе ин-
формации). Главные требования к Q&A: точность, опора на источники (evidence),

контроль галлюцинаций и понятная трассируемость, возможность проследить,
откуда взялся факт.

RAG (Retrieval-Augmented Generation) — это архитектура, которая решает
проблему «галлюцинаций» и устаревших знаний у языковых моделей. Сначала
retriever — часть пайплайна, которая отвечает за поиск и экстракцию нужного

фрагмента текста, — находит релевантные фрагменты в вашей базе знаний. За-
тем generator — языковая модель — формирует ответ, опираясь именно на эти

фрагменты. Тем самым знания подгружаются динамически: вы обновляете кор-
пус — и система отвечает по новым данным без дообучения самой модели.

Как это работает по шагам:
• Индексирование. Текстовые данные
разбиваются на чанки (chunks), для

каждого чанка рассчитываются эм-
беддинги, после чего строится вектор-
ный индекс для эффективного поиска.

• Извлечение. Для запроса генерируют-
ся эмбеддинги, и на основе этого вы-
полняется поиск в индексе, возвращая

топ-k ближайших чанков. Для повы-
шения точности результатов часто ис-
пользуется переранжировка с приме-
нением cross-encoder.

• Промптование. Отобранные тексто-
вые фрагменты передаются в модель с

инструкцией: «Используй только дан-
ные из контекста, ссылайся на источ-
ники. Если информация не найдена,

сообщи, что данных нет».

• Генерация. Языковая модель форми-
рует ответ, сохраняя необходимый

стиль, длину и ссылки. Также могут
быть добавлены верификаторы, такие

как self-check, answerability, и цити-
рование для повышения достоверно-
сти ответа.

4

Языковая модель в этой архитектуре появляется только на финальном этапе, так как

выступает не источником знаний, а обобщает и связно излагает релевантный кон-
текст, выделяет факты, корректирует неоднозначность формулировок и выдает фи-
нальный ответ. Большая часть качества идет не из огромной модели, а из инжене-
рии пайплайна: размер чанков, нормализация и очистка разметки, метрики близости

эмбеддингов и параметры поиска, реранжировка, промптинг инструкции, настройка
фильтров токсичности.

RAG-системы активно реализуются в чат-ботах, в том числе в банковских прило-
жениях, улучшая качество генерируемого ответа. Так, Альфа-Банк начал исполь-
зовать ИИ для помощи в выборе дебетовых карт. В 2023 году в Альфа-Банке нача-
лась разработка ИИ-платформы, позволяющей ускорить выполнение рутинных задач

сотрудников, AlfaGen, объединяющей несколько погруженных в контекст работы

в Альфа-Банке благодаря методу RAG языковых моделей. ИИ-агенты на базе RAG по-
зволяют не только успешно генерировать ответы на вопросы и искать информацию по

базе знаний. Команде системных аналитиков в Альфа-Банке удалось настроить аген-
та на проверку технической документации в «Альфа-Онлайне».

Бизнес-контекст

5

Критерии успеха

Ограничения

Основной критерий успешности решения — качество извлечения релевант-
ных документов для каждого вопроса. Оценка проводится по метрике Hit@5

на публичной (public, 70%) тестовой части: решение считается успешным, если
среди топ-5 найденных документов регулярно присутствует хотя бы один
релевантный.

Для создания и настройки модели вы можете использовать язык Python вер-
сии 3.10 и выше. Также вы можете использовать любую библиотеку для машин-
ного обучения и предобработки данных, являющуюся OpenSource-ресурсом.

Использование закрытых библиотек, частных API и чужого кода, не подпа-
дающего под разрешение о свободном распространении и использовании,

запрещено.

6

Описание данных

Пространство решений
Для разработки pipeline RAG-системы вы будете работать с таблицами:
1. Questions.csv — база вопросов, для которой вы настраиваете поисковую
систему. Она состоит:
a) из q_id — индивидуального номера каждого вопроса;
b) query — содержания вопроса.
2. Websites.csv — база знаний поисковой функции:
a) web_id — индивидуальный номер каждой веб страницы;
b) url — адрес веб-страницы;
c) kind — тип импортированных данных;
d) title — название страницы, ее заголовок;
e) text — колонка, содержащая заранее спарсенный со страницы текст.

Вы имеете право использовать любую модель из любой OpenSource-библиоте-
ки для векторизации текста и чанкования. Выбор и настройка модели не ограни-
чены организаторами.

В результате вашей работы вы долж-
ны отправить на платформу submit.

csv, файл-пример вашего сабмита
лежит на диске.

ССЫЛКА НА МАТЕРИАЛЫ

7

Приложение 1. Метрика Hit@K

Метрика Hit@k оценивает качество ретривера (поиска фрагментов) в задачах «вопрос-
ответ» и RAG. Она показывает, у какой доли вопросов среди первых k найденных

результатов присутствует хотя бы один релевантный элемент.
Для запроса q ретривер возвращает упорядоченный список результатов
Rq=[r1,...,rk,... ]. Пусть множество релевантных для q элементов — Gq. Тогда попадание
для запроса определяется так:

Итоговая метрика по выборке вопросов Q считается как среднее значение по всем
вопросам, для которых есть хотя бы одна размеченная релевантная страница (вопросы
без разметки в оценку не входят):

где Q — подмножество вопросов с непустым набором релевантных страниц.
Результат метрики Hit@k Интерпретация

Значение Hit@5=0,83 означает, что

в среднем система возвращает в топ-
5 большую часть релевантных страниц,

причём более важные страницы
(с большим весом) дают больший вклад
в итоговый балл. Чем ближе метрика к 1,
тем выше качество работы ретривера.

hit@k(q) =

1, если {r1,...,rk} Gq = , {0, иначе.

hit@k(q).
q Q
Hit@k =
1
Q Σ

8

Кейс создан совместно
с АО «Альфа-Банк»

www.alfabank.ru

Кейс написан и опубликован
Changellenge >> —
ведущей организацией
по кейсам в России.
www.changellenge.com